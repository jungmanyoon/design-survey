<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ ê²°ê³¼ ë³€í™˜ê¸°</title>
    <!-- JSZip for creating ZIP files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- SheetJS for creating Excel files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            margin: 0;
            padding: 30px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #8892b0;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* ë“œë¡­ì¡´ */
        .dropzone {
            background: white;
            border: 3px dashed #ccc;
            border-radius: 15px;
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .dropzone:hover, .dropzone.dragover {
            border-color: #4CAF50;
            background: #f0fff0;
        }

        .dropzone-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .dropzone-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }

        .dropzone-hint {
            font-size: 13px;
            color: #999;
        }

        /* íŒŒì¼ ëª©ë¡ */
        .file-list {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .file-list.show {
            display: block;
        }

        .file-list h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .file-item .icon {
            font-size: 20px;
            margin-right: 12px;
        }

        .file-item .name {
            flex: 1;
            font-size: 14px;
        }

        .file-item .company {
            color: #4CAF50;
            font-weight: 600;
            margin-right: 15px;
        }

        .file-item .dci {
            background: #003366;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .file-item .remove {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            margin-left: 10px;
        }

        /* ë²„íŠ¼ */
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(33, 150, 243, 0.4);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* ì§„í–‰ ìƒíƒœ */
        .progress-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .progress-section.show {
            display: block;
        }

        .progress-bar {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #666;
        }

        /* ê²°ê³¼ ìš”ì•½ */
        .summary {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .summary.show {
            display: block;
        }

        .summary h3 {
            margin: 0 0 15px 0;
            color: #003366;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .summary-table th, .summary-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .summary-table th {
            background: #003366;
            color: white;
        }

        .summary-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        /* ì•ˆë‚´ ë°•ìŠ¤ */
        .info-box {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            color: #ccc;
            font-size: 13px;
        }

        .info-box h4 {
            color: white;
            margin: 0 0 10px 0;
        }

        .info-box ul {
            margin: 0;
            padding-left: 20px;
        }

        .info-box li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ì„¤ë¬¸ ê²°ê³¼ ë³€í™˜ê¸°</h1>
        <p class="subtitle">JSON íŒŒì¼ë“¤ì„ ì—…ë¡œë“œí•˜ë©´ â†’ ì„¤ë¬¸ì§€(HTML) + ì¢…í•©ë¶„ì„(Excel)ë¡œ ë³€í™˜</p>

        <!-- ë“œë¡­ì¡´ -->
        <div class="dropzone" id="dropzone">
            <div class="dropzone-icon">ğŸ“</div>
            <div class="dropzone-text">JSON íŒŒì¼ë“¤ì„ ì—¬ê¸°ì— ë“œë˜ê·¸ & ë“œë¡­</div>
            <div class="dropzone-hint">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ (ì—¬ëŸ¬ íŒŒì¼ ê°€ëŠ¥)</div>
            <input type="file" id="fileInput" multiple accept=".json" style="display: none;">
        </div>

        <!-- íŒŒì¼ ëª©ë¡ -->
        <div class="file-list" id="fileList">
            <h3>ğŸ“‹ ì—…ë¡œë“œëœ íŒŒì¼ (<span id="fileCount">0</span>ê°œ)</h3>
            <div id="fileItems"></div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="actions">
            <button class="btn btn-primary" id="btnConvert" disabled>
                ğŸ”„ ë³€í™˜ ë° ë‹¤ìš´ë¡œë“œ (ZIP)
            </button>
            <button class="btn btn-secondary" id="btnExcelOnly" disabled>
                ğŸ“Š Excelë§Œ ë‹¤ìš´ë¡œë“œ
            </button>
            <button class="btn btn-danger" id="btnClear" style="display:none;">
                ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
            </button>
        </div>

        <!-- ì§„í–‰ ìƒíƒœ -->
        <div class="progress-section" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">ë³€í™˜ ì¤‘...</div>
        </div>

        <!-- ê²°ê³¼ ìš”ì•½ -->
        <div class="summary" id="summary">
            <h3>ğŸ“ˆ DCI ì ìˆ˜ ìš”ì•½</h3>
            <table class="summary-table" id="summaryTable">
                <thead>
                    <tr>
                        <th>íšŒì‚¬ëª…</th>
                        <th>ìë™í™” (40%)</th>
                        <th>í‘œì¤€í™” (25%)</th>
                        <th>ë¦¬ë“œíƒ€ì„ (15%)</th>
                        <th>ITì‹œìŠ¤í…œ (20%)</th>
                        <th>DCI ì¢…í•©</th>
                    </tr>
                </thead>
                <tbody id="summaryBody"></tbody>
            </table>
        </div>

        <!-- ì•ˆë‚´ -->
        <div class="info-box">
            <h4>ğŸ“Œ ì‚¬ìš© ë°©ë²•</h4>
            <ul>
                <li>ì„¤ë¬¸ ì‘ë‹µìë¡œë¶€í„° ë°›ì€ JSON íŒŒì¼ë“¤ì„ ë“œë˜ê·¸ & ë“œë¡­í•˜ì„¸ìš”.</li>
                <li>"ë³€í™˜ ë° ë‹¤ìš´ë¡œë“œ" í´ë¦­ â†’ ZIP íŒŒì¼ ìƒì„± (ê° ì—…ì²´ë³„ ì„¤ë¬¸ì§€ + Excel)</li>
                <li>ìƒì„±ëœ HTML íŒŒì¼ì€ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ ì¸ì‡„/PDF ì €ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </div>

    <script>
        // ì—…ë¡œë“œëœ íŒŒì¼ ë°ì´í„° ì €ì¥
        let uploadedFiles = [];

        // DOM ìš”ì†Œ
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const fileItems = document.getElementById('fileItems');
        const fileCount = document.getElementById('fileCount');
        const btnConvert = document.getElementById('btnConvert');
        const btnExcelOnly = document.getElementById('btnExcelOnly');
        const btnClear = document.getElementById('btnClear');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const summary = document.getElementById('summary');
        const summaryBody = document.getElementById('summaryBody');

        // ë“œë¡­ì¡´ ì´ë²¤íŠ¸
        dropzone.addEventListener('click', () => fileInput.click());

        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('dragover');
        });

        dropzone.addEventListener('dragleave', () => {
            dropzone.classList.remove('dragover');
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // íŒŒì¼ ì²˜ë¦¬
        async function handleFiles(files) {
            for (let file of files) {
                if (file.name.endsWith('.json')) {
                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);

                        // ì¤‘ë³µ ì²´í¬
                        const companyName = data.companyInfo?.companyName || 'ë¯¸ì…ë ¥';
                        const exists = uploadedFiles.some(f => f.companyName === companyName);

                        if (!exists) {
                            uploadedFiles.push({
                                fileName: file.name,
                                companyName: companyName,
                                data: data
                            });
                        }
                    } catch (err) {
                        alert(`íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ${file.name}\n${err.message}`);
                    }
                }
            }
            updateUI();
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            fileCount.textContent = uploadedFiles.length;

            if (uploadedFiles.length > 0) {
                fileList.classList.add('show');
                btnConvert.disabled = false;
                btnExcelOnly.disabled = false;
                btnClear.style.display = 'inline-flex';

                fileItems.innerHTML = uploadedFiles.map((file, index) => {
                    const dci = file.data.scores?.dci || 0;
                    return `
                        <div class="file-item">
                            <span class="icon">ğŸ“„</span>
                            <span class="name">${file.fileName}</span>
                            <span class="company">${file.companyName}</span>
                            <span class="dci">DCI ${dci.toFixed(2)}ì </span>
                            <button class="remove" onclick="removeFile(${index})">âœ•</button>
                        </div>
                    `;
                }).join('');

                // ìš”ì•½ í…Œì´ë¸” ì—…ë°ì´íŠ¸
                updateSummary();
            } else {
                fileList.classList.remove('show');
                btnConvert.disabled = true;
                btnExcelOnly.disabled = true;
                btnClear.style.display = 'none';
                summary.classList.remove('show');
            }
        }

        // íŒŒì¼ ì‚­ì œ
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateUI();
        }

        // ì „ì²´ ì‚­ì œ
        btnClear.addEventListener('click', () => {
            if (confirm('ëª¨ë“  íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                uploadedFiles = [];
                updateUI();
            }
        });

        // ìš”ì•½ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateSummary() {
            summary.classList.add('show');

            summaryBody.innerHTML = uploadedFiles.map(file => {
                const s = file.data.scores || {};
                return `
                    <tr>
                        <td><strong>${file.companyName}</strong></td>
                        <td>${(s.automation?.avg || 0).toFixed(1)}</td>
                        <td>${(s.standardization?.avg || 0).toFixed(1)}</td>
                        <td>${(s.leadtime?.avg || 0).toFixed(1)}</td>
                        <td>${(s.it_system?.avg || 0).toFixed(1)}</td>
                        <td><strong>${(s.dci || 0).toFixed(2)}</strong></td>
                    </tr>
                `;
            }).join('');
        }

        // ë³€í™˜ ë° ë‹¤ìš´ë¡œë“œ (ZIP)
        btnConvert.addEventListener('click', async () => {
            if (uploadedFiles.length === 0) return;

            progressSection.classList.add('show');
            progressFill.style.width = '0%';
            progressText.textContent = 'ë³€í™˜ ì¤€ë¹„ ì¤‘...';

            try {
                const zip = new JSZip();
                const total = uploadedFiles.length;

                // ê° íŒŒì¼ë³„ HTML ìƒì„±
                for (let i = 0; i < total; i++) {
                    const file = uploadedFiles[i];
                    progressText.textContent = `${file.companyName} ë³€í™˜ ì¤‘... (${i + 1}/${total})`;
                    progressFill.style.width = `${((i + 1) / (total + 1)) * 100}%`;

                    const html = generateFilledSurveyHTML(file.data);
                    const fileName = `${file.companyName}_ì„¤ë¬¸ê²°ê³¼.html`;
                    zip.file(fileName, html);

                    await sleep(100); // UI ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ë”œë ˆì´
                }

                // Excel ìƒì„±
                progressText.textContent = 'Excel ìƒì„± ì¤‘...';
                const excelData = generateExcelData();
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(excelData);
                XLSX.utils.book_append_sheet(wb, ws, 'DCI ë¶„ì„');
                const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                zip.file('ì¢…í•©ë¶„ì„_DCI.xlsx', excelBuffer);

                progressFill.style.width = '100%';
                progressText.textContent = 'ZIP íŒŒì¼ ìƒì„± ì¤‘...';

                // ZIP ë‹¤ìš´ë¡œë“œ
                const content = await zip.generateAsync({ type: 'blob' });
                const dateStr = new Date().toISOString().slice(0, 10);
                downloadBlob(content, `ì„¤ë¬¸ê²°ê³¼_ë³€í™˜_${dateStr}.zip`);

                progressText.textContent = 'âœ… ì™„ë£Œ! ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤.';
                setTimeout(() => {
                    progressSection.classList.remove('show');
                }, 3000);

            } catch (err) {
                alert('ë³€í™˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
                progressSection.classList.remove('show');
            }
        });

        // Excelë§Œ ë‹¤ìš´ë¡œë“œ
        btnExcelOnly.addEventListener('click', () => {
            if (uploadedFiles.length === 0) return;

            const excelData = generateExcelData();
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(excelData);

            // ì—´ ë„ˆë¹„ ì„¤ì •
            ws['!cols'] = [
                { wch: 15 }, // íšŒì‚¬ëª…
                { wch: 12 }, // ìë™í™”
                { wch: 12 }, // í‘œì¤€í™”
                { wch: 12 }, // ë¦¬ë“œíƒ€ì„
                { wch: 12 }, // ITì‹œìŠ¤í…œ
                { wch: 10 }, // DCI
            ];

            XLSX.utils.book_append_sheet(wb, ws, 'DCI ë¶„ì„');

            const dateStr = new Date().toISOString().slice(0, 10);
            XLSX.writeFile(wb, `DCI_ì¢…í•©ë¶„ì„_${dateStr}.xlsx`);
        });

        // Excel ë°ì´í„° ìƒì„±
        function generateExcelData() {
            const headers = ['íšŒì‚¬ëª…', 'ìë™í™” (40%)', 'í‘œì¤€í™” (25%)', 'ë¦¬ë“œíƒ€ì„ (15%)', 'ITì‹œìŠ¤í…œ (20%)', 'DCI ì¢…í•©'];
            const rows = uploadedFiles.map(file => {
                const s = file.data.scores || {};
                return [
                    file.companyName,
                    (s.automation?.avg || 0).toFixed(2),
                    (s.standardization?.avg || 0).toFixed(2),
                    (s.leadtime?.avg || 0).toFixed(2),
                    (s.it_system?.avg || 0).toFixed(2),
                    (s.dci || 0).toFixed(2)
                ];
            });

            // DCI ê¸°ì¤€ ì •ë ¬ (ë†’ì€ ìˆœ)
            rows.sort((a, b) => parseFloat(b[5]) - parseFloat(a[5]));

            return [headers, ...rows];
        }

        // ì±„ì›Œì§„ ì„¤ë¬¸ì§€ HTML ìƒì„±
        function generateFilledSurveyHTML(data) {
            const companyName = data.companyInfo?.companyName || 'ë¯¸ì…ë ¥';
            const surveyDate = data.companyInfo?.surveyDate || '';
            const scores = data.scores || {};
            const responses = data.responses || {};

            // ë¼ë””ì˜¤ ë²„íŠ¼ ì²´í¬ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
            let checkScript = '';
            for (const [name, resp] of Object.entries(responses)) {
                if (resp.value) {
                    checkScript += `
                        try {
                            const radio = document.querySelector('input[name="${name}"][value="${resp.value}"]');
                            if (radio) radio.checked = true;
                            const naCheckbox = document.querySelector('input[name="na_${name}"]');
                            if (naCheckbox && ${resp.value === 1}) naCheckbox.checked = true;
                        } catch(e) {}
                    `;
                }
            }

            return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ê²°ê³¼ - ${companyName}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .result-header {
            background: linear-gradient(135deg, #003366, #004080);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .result-header h1 {
            margin: 0 0 10px 0;
            font-size: 20px;
        }

        .result-header .company {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .score-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .score-box {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .score-box .label {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .score-box .value {
            font-size: 22px;
            font-weight: bold;
        }

        .score-box.dci {
            background: rgba(255, 215, 0, 0.3);
        }

        .score-box.dci .value {
            color: #ffd700;
        }

        .response-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .response-section h3 {
            color: #003366;
            margin: 0 0 15px 0;
            font-size: 16px;
            border-bottom: 2px solid #003366;
            padding-bottom: 8px;
        }

        .response-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .response-item:last-child {
            border-bottom: none;
        }

        .response-item .question {
            color: #666;
        }

        .response-item .answer {
            font-weight: 600;
            color: #003366;
        }

        @media print {
            body { background: white; padding: 0; }
            .result-header { margin: 0 0 20px 0; }
            .response-section { margin: 0 0 15px 0; box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="result-header">
        <h1>ğŸ“‹ ì„¤ë¬¸ ê²°ê³¼</h1>
        <div class="company">${companyName}</div>
        <div>ì¡°ì‚¬ ì¼ì: ${surveyDate || data.meta?.exportDateKR || '-'}</div>
        <div class="score-grid">
            <div class="score-box">
                <div class="label">ìë™í™” (40%)</div>
                <div class="value">${(scores.automation?.avg || 0).toFixed(1)}</div>
            </div>
            <div class="score-box">
                <div class="label">í‘œì¤€í™” (25%)</div>
                <div class="value">${(scores.standardization?.avg || 0).toFixed(1)}</div>
            </div>
            <div class="score-box">
                <div class="label">ë¦¬ë“œíƒ€ì„ (15%)</div>
                <div class="value">${(scores.leadtime?.avg || 0).toFixed(1)}</div>
            </div>
            <div class="score-box">
                <div class="label">ITì‹œìŠ¤í…œ (20%)</div>
                <div class="value">${(scores.it_system?.avg || 0).toFixed(1)}</div>
            </div>
            <div class="score-box dci">
                <div class="label">DCI ì¢…í•©</div>
                <div class="value">${(scores.dci || 0).toFixed(2)}</div>
            </div>
        </div>
    </div>

    <div class="response-section">
        <h3>ğŸ“Š ìƒì„¸ ì‘ë‹µ ë‚´ì—­</h3>
        ${Object.entries(responses).map(([key, val]) => `
            <div class="response-item">
                <span class="question">${key}</span>
                <span class="answer">${val.label || val.value || '-'} (${val.value}ì )</span>
            </div>
        `).join('')}
    </div>

    ${data.remarks && data.remarks.length > 0 ? `
    <div class="response-section">
        <h3>ğŸ“ ë¹„ê³ /íŠ¹ì´ì‚¬í•­</h3>
        ${data.remarks.map(r => `<p>${r}</p>`).join('')}
    </div>
    ` : ''}
</body>
</html>`;
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function downloadBlob(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
