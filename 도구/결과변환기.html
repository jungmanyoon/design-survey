<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ë¬¸ ê²°ê³¼ ë³€í™˜ê¸°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        * { box-sizing: border-box; }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            margin: 0;
            padding: 30px;
            color: #333;
        }

        .container { max-width: 900px; margin: 0 auto; }

        h1 { color: white; text-align: center; margin-bottom: 10px; font-size: 28px; }

        .subtitle { color: #8892b0; text-align: center; margin-bottom: 30px; font-size: 14px; }

        /* ì„¤ì • ì„¹ì…˜ */
        .config-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .config-section h3 {
            margin: 0 0 15px 0;
            color: #003366;
            font-size: 16px;
        }

        .config-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }

        .config-row label {
            min-width: 120px;
            font-weight: 600;
            color: #555;
        }

        .config-row input[type="file"] {
            flex: 1;
        }

        .template-status {
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 13px;
        }

        .template-status.loaded {
            background: #d4edda;
            color: #155724;
        }

        .template-status.empty {
            background: #fff3cd;
            color: #856404;
        }

        /* ë“œë¡­ì¡´ */
        .dropzone {
            background: white;
            border: 3px dashed #ccc;
            border-radius: 15px;
            padding: 50px 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .dropzone:hover, .dropzone.dragover {
            border-color: #4CAF50;
            background: #f0fff0;
        }

        .dropzone-icon { font-size: 60px; margin-bottom: 15px; }
        .dropzone-text { font-size: 18px; color: #666; margin-bottom: 10px; }
        .dropzone-hint { font-size: 13px; color: #999; }

        /* íŒŒì¼ ëª©ë¡ */
        .file-list {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .file-list.show { display: block; }

        .file-list h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .file-item .icon { font-size: 20px; margin-right: 12px; }
        .file-item .name { flex: 1; font-size: 14px; }
        .file-item .company { color: #4CAF50; font-weight: 600; margin-right: 15px; }
        .file-item .dci {
            background: #003366;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        .file-item .remove {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            margin-left: 10px;
        }

        /* ë²„íŠ¼ */
        .actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* ì§„í–‰ ìƒíƒœ */
        .progress-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .progress-section.show { display: block; }

        .progress-bar {
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text { text-align: center; font-size: 14px; color: #666; }

        /* ìš”ì•½ í…Œì´ë¸” */
        .summary {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .summary.show { display: block; }
        .summary h3 { margin: 0 0 15px 0; color: #003366; }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .summary-table th, .summary-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .summary-table th { background: #003366; color: white; }
        .summary-table tr:nth-child(even) { background: #f8f9fa; }

        /* ì•ˆë‚´ */
        .info-box {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            color: #ccc;
            font-size: 13px;
        }

        .info-box h4 { color: white; margin: 0 0 10px 0; }
        .info-box ul { margin: 0; padding-left: 20px; }
        .info-box li { margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ì„¤ë¬¸ ê²°ê³¼ ë³€í™˜ê¸°</h1>
        <p class="subtitle">JSON íŒŒì¼ â†’ ì›ë³¸ ì„¤ë¬¸ì§€ì— ì‘ë‹µì´ ì±„ì›Œì§„ HTML + Excel</p>

        <!-- ì„¤ë¬¸ì§€ í…œí”Œë¦¿ ì—…ë¡œë“œ -->
        <div class="config-section">
            <h3>1ï¸âƒ£ ì„¤ë¬¸ì§€ í…œí”Œë¦¿ ì„ íƒ</h3>
            <div class="config-row">
                <label>ì„¤ë¬¸ì§€ HTML:</label>
                <input type="file" id="templateInput" accept=".html">
                <span class="template-status empty" id="templateStatus">í…œí”Œë¦¿ í•„ìš”</span>
            </div>
            <div style="font-size: 12px; color: #888; margin-top: 8px;">
                * ì„¤ë¬¸ì§€_í•œê¸€.html ë˜ëŠ” ì„¤ë¬¸ì§€_í•´ì™¸.html íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.
            </div>
        </div>

        <!-- JSON ë“œë¡­ì¡´ -->
        <div class="dropzone" id="dropzone">
            <div class="dropzone-icon">ğŸ“</div>
            <div class="dropzone-text">2ï¸âƒ£ JSON íŒŒì¼ë“¤ì„ ì—¬ê¸°ì— ë“œë˜ê·¸ & ë“œë¡­</div>
            <div class="dropzone-hint">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ (ì—¬ëŸ¬ íŒŒì¼ ê°€ëŠ¥)</div>
            <input type="file" id="fileInput" multiple accept=".json" style="display: none;">
        </div>

        <!-- íŒŒì¼ ëª©ë¡ -->
        <div class="file-list" id="fileList">
            <h3>ğŸ“‹ ì—…ë¡œë“œëœ JSON íŒŒì¼ (<span id="fileCount">0</span>ê°œ)</h3>
            <div id="fileItems"></div>
        </div>

        <!-- ë²„íŠ¼ -->
        <div class="actions">
            <button class="btn btn-primary" id="btnConvert" disabled>
                ğŸ”„ ë³€í™˜ ë° ë‹¤ìš´ë¡œë“œ (ZIP)
            </button>
            <button class="btn btn-secondary" id="btnExcelOnly" disabled>
                ğŸ“Š Excelë§Œ ë‹¤ìš´ë¡œë“œ
            </button>
        </div>

        <!-- ì§„í–‰ ìƒíƒœ -->
        <div class="progress-section" id="progressSection">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">ë³€í™˜ ì¤‘...</div>
        </div>

        <!-- ìš”ì•½ -->
        <div class="summary" id="summary">
            <h3>ğŸ“ˆ DCI ì ìˆ˜ ìš”ì•½</h3>
            <table class="summary-table">
                <thead>
                    <tr>
                        <th>íšŒì‚¬ëª…</th>
                        <th>ìë™í™” (40%)</th>
                        <th>í‘œì¤€í™” (25%)</th>
                        <th>ë¦¬ë“œíƒ€ì„ (15%)</th>
                        <th>ITì‹œìŠ¤í…œ (20%)</th>
                        <th>DCI ì¢…í•©</th>
                    </tr>
                </thead>
                <tbody id="summaryBody"></tbody>
            </table>
        </div>

        <!-- ì•ˆë‚´ -->
        <div class="info-box">
            <h4>ğŸ“Œ ì‚¬ìš© ë°©ë²•</h4>
            <ul>
                <li><strong>1ë‹¨ê³„:</strong> ì„¤ë¬¸ì§€ í…œí”Œë¦¿ HTML íŒŒì¼ ì„ íƒ (ì„¤ë¬¸ì§€_í•œê¸€.html)</li>
                <li><strong>2ë‹¨ê³„:</strong> ì‘ë‹µìë¡œë¶€í„° ë°›ì€ JSON íŒŒì¼ë“¤ ë“œë˜ê·¸ & ë“œë¡­</li>
                <li><strong>3ë‹¨ê³„:</strong> "ë³€í™˜ ë° ë‹¤ìš´ë¡œë“œ" í´ë¦­</li>
                <li>ê²°ê³¼: ê° ì—…ì²´ë³„ë¡œ ì‘ë‹µì´ ì±„ì›Œì§„ ì„¤ë¬¸ì§€ HTML + ì¢…í•©ë¶„ì„ Excel</li>
            </ul>
        </div>
    </div>

    <script>
        let surveyTemplate = null;
        let uploadedFiles = [];

        const templateInput = document.getElementById('templateInput');
        const templateStatus = document.getElementById('templateStatus');
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const fileItems = document.getElementById('fileItems');
        const fileCount = document.getElementById('fileCount');
        const btnConvert = document.getElementById('btnConvert');
        const btnExcelOnly = document.getElementById('btnExcelOnly');
        const progressSection = document.getElementById('progressSection');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const summary = document.getElementById('summary');
        const summaryBody = document.getElementById('summaryBody');

        // í…œí”Œë¦¿ ë¡œë“œ
        templateInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file && file.name.endsWith('.html')) {
                surveyTemplate = await file.text();
                templateStatus.textContent = 'âœ… ' + file.name;
                templateStatus.classList.remove('empty');
                templateStatus.classList.add('loaded');
                updateButtons();
            }
        });

        // ë“œë¡­ì¡´
        dropzone.addEventListener('click', () => fileInput.click());
        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('dragover');
        });
        dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

        async function handleFiles(files) {
            for (let file of files) {
                if (file.name.endsWith('.json')) {
                    try {
                        const text = await file.text();
                        const data = JSON.parse(text);
                        const companyName = data.companyInfo?.companyName || 'ë¯¸ì…ë ¥';

                        if (!uploadedFiles.some(f => f.companyName === companyName)) {
                            uploadedFiles.push({ fileName: file.name, companyName, data });
                        }
                    } catch (err) {
                        alert(`íŒŒì¼ ì½ê¸° ì˜¤ë¥˜: ${file.name}`);
                    }
                }
            }
            updateUI();
        }

        function updateUI() {
            fileCount.textContent = uploadedFiles.length;

            if (uploadedFiles.length > 0) {
                fileList.classList.add('show');
                fileItems.innerHTML = uploadedFiles.map((file, i) => {
                    const dci = file.data.scores?.dci || 0;
                    return `
                        <div class="file-item">
                            <span class="icon">ğŸ“„</span>
                            <span class="name">${file.fileName}</span>
                            <span class="company">${file.companyName}</span>
                            <span class="dci">DCI ${dci.toFixed(2)}ì </span>
                            <button class="remove" onclick="removeFile(${i})">âœ•</button>
                        </div>
                    `;
                }).join('');
                updateSummary();
            } else {
                fileList.classList.remove('show');
                summary.classList.remove('show');
            }
            updateButtons();
        }

        function updateButtons() {
            const ready = surveyTemplate && uploadedFiles.length > 0;
            btnConvert.disabled = !ready;
            btnExcelOnly.disabled = uploadedFiles.length === 0;
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            updateUI();
        }

        function updateSummary() {
            summary.classList.add('show');
            summaryBody.innerHTML = uploadedFiles.map(file => {
                const s = file.data.scores || {};
                return `
                    <tr>
                        <td><strong>${file.companyName}</strong></td>
                        <td>${(s.automation?.avg || 0).toFixed(1)}</td>
                        <td>${(s.standardization?.avg || 0).toFixed(1)}</td>
                        <td>${(s.leadtime?.avg || 0).toFixed(1)}</td>
                        <td>${(s.it_system?.avg || 0).toFixed(1)}</td>
                        <td><strong>${(s.dci || 0).toFixed(2)}</strong></td>
                    </tr>
                `;
            }).join('');
        }

        // ë³€í™˜
        btnConvert.addEventListener('click', async () => {
            if (!surveyTemplate || uploadedFiles.length === 0) return;

            progressSection.classList.add('show');
            progressFill.style.width = '0%';

            try {
                const zip = new JSZip();
                const total = uploadedFiles.length;

                for (let i = 0; i < total; i++) {
                    const file = uploadedFiles[i];
                    progressText.textContent = `${file.companyName} ë³€í™˜ ì¤‘... (${i + 1}/${total})`;
                    progressFill.style.width = `${((i + 1) / (total + 1)) * 100}%`;

                    const html = generateFilledHTML(surveyTemplate, file.data);
                    zip.file(`${file.companyName}_ì„¤ë¬¸ê²°ê³¼.html`, html);
                    await sleep(50);
                }

                // Excel ìƒì„±
                progressText.textContent = 'Excel ìƒì„± ì¤‘...';
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.aoa_to_sheet(generateExcelData());
                ws['!cols'] = [{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:10}];
                XLSX.utils.book_append_sheet(wb, ws, 'DCI ë¶„ì„');
                const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                zip.file('ì¢…í•©ë¶„ì„_DCI.xlsx', excelBuffer);

                progressFill.style.width = '100%';
                progressText.textContent = 'ZIP ìƒì„± ì¤‘...';

                const content = await zip.generateAsync({ type: 'blob' });
                const dateStr = new Date().toISOString().slice(0, 10);
                downloadBlob(content, `ì„¤ë¬¸ê²°ê³¼_${dateStr}.zip`);

                progressText.textContent = 'âœ… ì™„ë£Œ!';
                setTimeout(() => progressSection.classList.remove('show'), 2000);

            } catch (err) {
                alert('ì˜¤ë¥˜: ' + err.message);
                progressSection.classList.remove('show');
            }
        });

        // Excelë§Œ ë‹¤ìš´ë¡œë“œ
        btnExcelOnly.addEventListener('click', () => {
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(generateExcelData());
            ws['!cols'] = [{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:10}];
            XLSX.utils.book_append_sheet(wb, ws, 'DCI ë¶„ì„');
            XLSX.writeFile(wb, `DCI_ì¢…í•©ë¶„ì„_${new Date().toISOString().slice(0,10)}.xlsx`);
        });

        function generateExcelData() {
            const headers = ['íšŒì‚¬ëª…', 'ìë™í™”(40%)', 'í‘œì¤€í™”(25%)', 'ë¦¬ë“œíƒ€ì„(15%)', 'ITì‹œìŠ¤í…œ(20%)', 'DCI'];
            const rows = uploadedFiles.map(f => {
                const s = f.data.scores || {};
                return [
                    f.companyName,
                    (s.automation?.avg || 0).toFixed(2),
                    (s.standardization?.avg || 0).toFixed(2),
                    (s.leadtime?.avg || 0).toFixed(2),
                    (s.it_system?.avg || 0).toFixed(2),
                    (s.dci || 0).toFixed(2)
                ];
            });
            rows.sort((a, b) => parseFloat(b[5]) - parseFloat(a[5]));
            return [headers, ...rows];
        }

        // í•µì‹¬: ì›ë³¸ ì„¤ë¬¸ì§€ HTMLì— JSON ë°ì´í„° ì±„ì›Œë„£ê¸°
        function generateFilledHTML(template, jsonData) {
            const companyName = jsonData.companyInfo?.companyName || 'ë¯¸ì…ë ¥';
            const surveyDate = jsonData.companyInfo?.surveyDate || '';
            const responses = jsonData.responses || {};
            const textInputs = jsonData.textInputs || {};
            const staffCounts = jsonData.staffCounts || {};
            const checkboxResponses = jsonData.checkboxResponses || {};
            const remarks = jsonData.remarks || [];
            const scores = jsonData.scores || {};

            // DCI ì ìˆ˜ í‘œì‹œ ë°°ë„ˆ ì¶”ê°€
            const scoreBanner = `
            <div style="background: linear-gradient(135deg, #003366, #004080); color: white; padding: 15px 20px; margin: 0 auto 10px; max-width: 210mm; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <div style="font-size: 18px; font-weight: bold;">ğŸ“‹ ${companyName} ì„¤ë¬¸ ê²°ê³¼</div>
                <div style="display: flex; gap: 15px; font-size: 13px;">
                    <span>ìë™í™”: <strong>${(scores.automation?.avg || 0).toFixed(1)}</strong></span>
                    <span>í‘œì¤€í™”: <strong>${(scores.standardization?.avg || 0).toFixed(1)}</strong></span>
                    <span>L/T: <strong>${(scores.leadtime?.avg || 0).toFixed(1)}</strong></span>
                    <span>IT: <strong>${(scores.it_system?.avg || 0).toFixed(1)}</strong></span>
                    <span style="color: #ffd700; font-size: 16px;">DCI: <strong>${(scores.dci || 0).toFixed(2)}</strong></span>
                </div>
            </div>`;

            // ë°ì´í„° ì±„ì›Œë„£ê¸° ìŠ¤í¬ë¦½íŠ¸
            const fillScript = `
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const responses = ${JSON.stringify(responses)};
                const textInputs = ${JSON.stringify(textInputs)};
                const staffCounts = ${JSON.stringify(staffCounts)};
                const checkboxResponses = ${JSON.stringify(checkboxResponses)};
                const remarks = ${JSON.stringify(remarks)};

                // íšŒì‚¬ëª…, ë‚ ì§œ ì…ë ¥
                const dateInput = document.querySelector('input[placeholder="2025.12.XX"]');
                const companyInput = document.querySelector('input[placeholder="ê¸°ì—…ëª…"]');
                if (dateInput) dateInput.value = "${surveyDate}";
                if (companyInput) companyInput.value = "${companyName}";

                // ë¼ë””ì˜¤ ë²„íŠ¼ ì²´í¬
                for (const [name, resp] of Object.entries(responses)) {
                    if (name.startsWith('na_')) {
                        // í•´ë‹¹ì—†ìŒ ì²´í¬ë°•ìŠ¤
                        const cb = document.querySelector('input[name="' + name + '"]');
                        if (cb) cb.checked = true;
                    } else {
                        const radio = document.querySelector('input[name="' + name + '"][value="' + resp.value + '"]');
                        if (radio) radio.checked = true;
                    }
                }

                // ì²´í¬ë°•ìŠ¤ (ìë™ ìƒì„± ê²°ê³¼ë¬¼ ë“±)
                for (const [section, labels] of Object.entries(checkboxResponses)) {
                    labels.forEach(label => {
                        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
                        checkboxes.forEach(cb => {
                            const cbLabel = cb.parentElement?.textContent?.trim();
                            if (cbLabel && cbLabel.includes(label.replace(/\\s/g, ''))) {
                                cb.checked = true;
                            }
                        });
                    });
                }

                // í…ìŠ¤íŠ¸ ì…ë ¥
                for (const [placeholder, value] of Object.entries(textInputs)) {
                    const input = document.querySelector('input[placeholder="' + placeholder + '"]');
                    if (input) input.value = value;
                }

                // ì¸ì›ìˆ˜ ì…ë ¥ (íŒ€ë³„)
                const teamTextareas = document.querySelectorAll('textarea.team-name');
                teamTextareas.forEach(ta => {
                    const teamName = ta.value.trim() || ta.placeholder;
                    if (staffCounts[teamName]) {
                        const row = ta.closest('tr');
                        const numbers = row?.querySelectorAll('input[type="number"]');
                        if (numbers && numbers.length >= 2) {
                            numbers[0].value = staffCounts[teamName].internal || '';
                            numbers[1].value = staffCounts[teamName].external || '';
                        }
                    }
                });

                // ë¹„ê³ /íŠ¹ì´ì‚¬í•­
                if (remarks.length > 0) {
                    const remarkTextareas = document.querySelectorAll('.remarks-box textarea');
                    remarkTextareas.forEach((ta, idx) => {
                        if (remarks[idx]) ta.value = remarks[idx];
                    });
                }

                // í¼ ë¹„í™œì„±í™” (ì½ê¸° ì „ìš©)
                document.querySelectorAll('input, textarea, select').forEach(el => {
                    el.style.pointerEvents = 'none';
                });
            });
            <\/script>`;

            // í…œí”Œë¦¿ì— ë°°ë„ˆì™€ ìŠ¤í¬ë¦½íŠ¸ ì‚½ì…
            let result = template;

            // <body> íƒœê·¸ ë°”ë¡œ ë’¤ì— ë°°ë„ˆ ì‚½ì…
            result = result.replace(/<body[^>]*>/i, (match) => match + scoreBanner);

            // </body> íƒœê·¸ ì•ì— ìŠ¤í¬ë¦½íŠ¸ ì‚½ì…
            result = result.replace('</body>', fillScript + '</body>');

            // íƒ€ì´í‹€ ë³€ê²½
            result = result.replace(/<title>[^<]*<\/title>/i, `<title>ì„¤ë¬¸ê²°ê³¼ - ${companyName}</title>`);

            return result;
        }

        function downloadBlob(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
